{%- macro ipaddr(net="") %}
{%- set host_num = ansible_default_ipv4.address | ipaddr("int") - ansible_default_ipv4.network | ipaddr("int") %}
{{- net | ipaddr(host_num) }}
{%- endmacro %}
network:
    version: 2
    vlans:
{% for iface in ['ceph', 'k8s'] %}
       {{hostvars[inventory_hostname][iface]['iface']}} :
            addresses:
            - {{ipaddr(hostvars[inventory_hostname][iface]['net'])}}
            id: {{hostvars[inventory_hostname][iface]['vlan']}}
            link: {{bond_name}}
            mtu: {{hostvars[inventory_hostname][iface]['mtu'] | default('1500')}}
{% endfor %}
